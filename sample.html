<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
<link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet" />
<script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Plan Do Launch",
  "url": "https://plandolaunch.com",
  "logo": "https://plandolaunch.com/plandolaunch.png",
  "description": "AI-enabled SaaS onboarding frameworks, portals, and delivery copilots.",
  "founder": {
    "@type": "Person",
    "name": "John A. McDonald"
  },
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "sales",
    "email": "info@plandolaunch.com"
  }
}
</script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Plan Do Launch — SaaS Onboarding Frameworks for Scalable Growth</title>
    <meta property="og:title" content="Plan Do Launch — Proven Onboarding Frameworks for SaaS &amp; Compliance Teams">
    <meta name="description" content="Plan Do Launch helps SaaS and compliance teams scale faster with proven onboarding frameworks, playbooks, and lightweight portals that reduce time-to-onboard by up to 40% while increasing team capacity 3×.">
    <meta property="og:description" content="From chaos to repeatable onboarding. Plan Do Launch designs playbooks, portals, and frameworks that scale clients and teams without friction.
">
    <link rel="icon" type="image/png" sizes="1024x1024" href="assets/img/favicon.png">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/bss-overrides.css">
    <link rel="stylesheet" href="assets/css/onboarding.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg sticky-top py-3 navbar-dark pdl-hero" role="navigation" aria-label="Primary">
        <div class="container"><a class="navbar-brand fw-bold text-white" href="/"><img class="img-fluid" src="assets/img/plandolaunch.png" width="175" height="175"></a><button data-bs-toggle="collapse" data-bs-target="#pdlNav" class="navbar-toggler border-0" type="button" aria-controls="pdlNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="pdlNav"></div>
        </div>
    </nav><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script><!-- InvestorCOM Chat Widget -->
<div class="container my-5" id="ic-chat">
  <div class="card shadow-sm">

    <!-- Header -->
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <div>
        <h5 class="mb-0">AcmeCOMPLY Support</h5>
        <small>Compliance Products</small>
      </div>
      <div class="d-flex gap-2 align-items-center">
        <select id="product" class="form-select form-select-sm">
          <option value="">Auto</option>
          <option value="regbi">RegBI Comparison</option>
          <option value="rollover">DOL Rollover Recommendationg</option>
        </select>
        <button id="reset" class="btn btn-sm btn-light text-primary">Reset</button>
      </div>
    </div>

    <!-- Body (this is the part that was missing) -->
    <div class="card-body">
      <!-- Chat log -->
      <div id="chat" class="border rounded p-3 mb-3" style="height:360px; overflow:auto; background:#fff;"></div>

      <!-- Input form -->
      <form id="ask" class="d-flex gap-2">
        <input id="q" type="text" class="form-control" placeholder="Ask a question…" autocomplete="off">
        <button class="btn btn-primary" type="submit">Send</button>
      </form>

      <!-- Status line (optional) -->
      <div id="status" class="text-muted small mt-2">Connecting…</div>
    </div>

  </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', () => {
  const API = "https://ask-john.jmcdonald-consultant.workers.dev/api/ask-john"; // <-- your Worker URL

  const chat       = document.getElementById('chat');
  const form       = document.getElementById('ask');
  const q          = document.getElementById('q');
  const statusEl   = document.getElementById('status');
  const productSel = document.getElementById('product'); // optional
  const resetBtn   = document.getElementById('reset');   // optional

  if (!chat || !form || !q) {
    console.error('Missing chat/form/q elements. Check IDs.');
    return;
  }

  if (statusEl) statusEl.textContent = 'Connected to Ask John';

  let conversationId = null;

  function renderMarkdown(text) {
    if (typeof marked !== 'undefined') {
      try {
        return marked.parse(text);
      } catch {
        // fall through
      }
    }
    return String(text || '').replace(/</g, '&lt;');
  }

  function add(role, text, isMarkdown = false) {
    const div = document.createElement('div');
    div.classList.add('mb-2');

    if (isMarkdown && role === 'Agent') {
      div.innerHTML = `<strong>${role}:</strong><br>${renderMarkdown(text || '')}`;
    } else {
      div.innerHTML = `<strong>${role}:</strong> ${String(text ?? '').replace(/</g,'&lt;')}`;
    }

    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  function inferProduct(question) {
    const qLower = question.toLowerCase();
    if (qLower.includes('peercompare') || qLower.includes('peer compare')) return 'peercompare';
    if (qLower.includes('rolloveranalyzer') || qLower.includes('rollover analyzer')) return 'rolloveranalyzer';
    return '';
  }

  // Initial greeting  ✅ UPDATED
  add(
    'Agent',
    "Hi, I'm Ask John — your onboarding and compliance guide. I can help you understand key workflows and simplify client experiences. What would you like to know?"
  );

  // Reset conversation (only if button exists)  ✅ UPDATED
  if (resetBtn) {
    resetBtn.addEventListener('click', () => {
      conversationId = null;
      chat.innerHTML = '';
      add(
        'Agent',
        "Hi, I'm Ask John — your onboarding and compliance guide. What onboarding or compliance challenge are you working on today?"
      );
    });
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const question = q.value.trim();
    if (!question) return;

    // If dropdown exists, use it; otherwise auto-detect
    const explicitProduct = productSel ? productSel.value : '';
    const product = explicitProduct || inferProduct(question);

    add('You', question);
    q.value = '';

    // "Thinking…" indicator
    const thinkingDiv = document.createElement('div');
    thinkingDiv.classList.add('mb-2', 'text-muted', 'fst-italic');
    thinkingDiv.textContent = 'Agent is thinking...';
    chat.appendChild(thinkingDiv);
    chat.scrollTop = chat.scrollHeight;

    try {
      const r = await fetch(API, {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({ question, conversationId, product })
      });

      thinkingDiv.remove();

      if (!r.ok) {
        const txt = await r.text();
        add('Agent', `Error (${r.status}): ${txt.slice(0,200)}`);
        return;
      }

      const data = await r.json();
      if (data.error) {
        add('Agent', `Error: ${data.error}`);
        return;
      }

      add('Agent', data.text || '(no text)', true);
      if (data.conversationId) conversationId = data.conversationId;
    } catch (err) {
      thinkingDiv.remove();
      add('Agent', 'Network error: ' + err.message);
    }
  });
});
</script>

    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://assets.calendly.com/assets/external/widget.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>

</html>